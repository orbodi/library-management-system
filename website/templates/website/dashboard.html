{% extends 'website/base.html' %}

{% block title %}Tableau de bord - Bibliothèque{% endblock %}

{% block content %}
<div class="container my-5">
    <h1 class="mb-4">
        <i class="bi bi-speedometer2"></i> Tableau de bord bibliothécaire
    </h1>

    <!-- Statistiques -->
    <div class="row g-4 mb-5">
        <div class="col-md-3">
            <div class="card text-white" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                <div class="card-body text-center">
                    <i class="bi bi-book-fill" style="font-size: 2.5rem;"></i>
                    <h2 class="mt-3">{{ total_books }}</h2>
                    <p class="mb-0">Total livres</p>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="card text-white" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                <div class="card-body text-center">
                    <i class="bi bi-check-circle-fill" style="font-size: 2.5rem;"></i>
                    <h2 class="mt-3">{{ available_books }}</h2>
                    <p class="mb-0">Disponibles</p>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="card text-white" style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);">
                <div class="card-body text-center">
                    <i class="bi bi-bookmark-fill" style="font-size: 2.5rem;"></i>
                    <h2 class="mt-3">{{ active_loans }}</h2>
                    <p class="mb-0">Emprunts actifs</p>
                </div>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="card text-white bg-danger">
                <div class="card-body text-center">
                    <i class="bi bi-exclamation-triangle-fill" style="font-size: 2.5rem;"></i>
                    <h2 class="mt-3">{{ overdue_loans }}</h2>
                    <p class="mb-0">En retard</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Emprunts en retard -->
    {% if overdue_list %}
        <div class="card border-danger mb-4">
            <div class="card-header bg-danger text-white">
                <h4 class="mb-0">
                    <i class="bi bi-exclamation-triangle"></i> Emprunts en retard
                </h4>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead>
                            <tr>
                                <th>Livre</th>
                                <th>Emprunteur</th>
                                <th>Date de retour prévue</th>
                                <th>Jours de retard</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for loan in overdue_list %}
                                <tr>
                                    <td>
                                        <strong>{{ loan.book.title }}</strong><br>
                                        <small class="text-muted">{{ loan.book.author }}</small>
                                    </td>
                                    <td>
                                        {{ loan.borrower.get_full_name }}<br>
                                        <small class="text-muted">{{ loan.borrower.profile.matricule|default:"-" }}</small>
                                    </td>
                                    <td>{{ loan.due_date|date:"d/m/Y" }}</td>
                                    <td>
                                        <span class="badge bg-danger">{{ loan.days_overdue }} jour(s)</span>
                                    </td>
                                    <td>
                                        <a href="{% url 'return_book' loan.id %}" class="btn btn-sm btn-primary">
                                            <i class="bi bi-arrow-return-left"></i> Retourner
                                        </a>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    {% endif %}

    <!-- Emprunts récents -->
    <div class="card">
        <div class="card-header">
            <h4 class="mb-0">
                <i class="bi bi-clock-history"></i> Emprunts récents
            </h4>
        </div>
        <div class="card-body">
            {% if recent_loans %}
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Livre</th>
                                <th>Emprunteur</th>
                                <th>Date d'emprunt</th>
                                <th>Date de retour prévue</th>
                                <th>Statut</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for loan in recent_loans %}
                                <tr>
                                    <td>
                                        <strong>{{ loan.book.title }}</strong><br>
                                        <small class="text-muted">{{ loan.book.author }}</small>
                                    </td>
                                    <td>{{ loan.borrower.get_full_name }}</td>
                                    <td>{{ loan.borrow_date|date:"d/m/Y" }}</td>
                                    <td>{{ loan.due_date|date:"d/m/Y" }}</td>
                                    <td>
                                        {% if loan.status == 'ACTIVE' %}
                                            <span class="badge bg-success">En cours</span>
                                        {% elif loan.status == 'OVERDUE' %}
                                            <span class="badge bg-danger">En retard</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <a href="{% url 'return_book' loan.id %}" class="btn btn-sm btn-primary">
                                            <i class="bi bi-arrow-return-left"></i> Retourner
                                        </a>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="alert alert-info mb-0">
                    <i class="bi bi-info-circle"></i> Aucun emprunt récent.
                </div>
            {% endif %}
        </div>
        <div class="card-footer">
            <a href="{% url 'loan_list' %}" class="btn btn-primary">
                <i class="bi bi-list"></i> Voir tous les emprunts
            </a>
        </div>
    </div>
</div>
{% endblock %}


